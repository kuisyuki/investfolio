# 実装タスクリスト

## 現在の実装状況サマリー
- ✅ 開発環境（DevContainer、Docker Compose）完了
- ✅ バックエンド基盤（FastAPI、SQLAlchemy接続）完了
- ✅ フロントエンド基盤（Next.js、TailwindCSS、基本レイアウト）完了
- ✅ インフラ基盤（MySQL、Redis、ELK Stack、Nginx）完了
- ⚠️ データモデル（models/__init__.pyは存在するが実際のモデルファイルが未作成）
- ⚠️ 認証機能（AuthContextは基本実装済みだが、API連携が未実装）
- ❌ データベースマイグレーション未実装
- ❌ 実際のビジネスロジック（株式管理、配当管理等）未実装

## 次の優先タスク
1. **データベース設計とマイグレーション** (タスク3, 3.1)
2. **データモデル実装** (タスク5) - 既存の__init__.pyとの整合性確保
3. **認証システム完成** (タスク6, 14) - API連携の実装
4. **株式管理API実装** (タスク7, 15)

- [x] 1. 開発環境セットアップ
  - DevContainer設定ファイル（.devcontainer/devcontainer.json）の作成
  - Dockerfile作成とUbuntu 24.04基盤の開発環境構築
  - PostCreateCommand.sh、PostStartCommand.shスクリプトの作成
  - Volta、pnpm、uv/uvx、sql-migrateのインストール設定
  - _要件: 6.1, 6.2, 6.3, 6.4, 6.5, 6.6, 6.7, 6.8_

- [x] 2. Docker Compose環境構築
  - docker-compose.ymlファイルの作成
  - MySQL 8.0、Redis 7、Elasticsearch 8.11.0、Kibana、Filebeatコンテナの設定
  - 開発用ネットワークとボリューム設定
  - Nginxリバースプロキシの基本設定
  - _要件: 7.4, 7.6, 8.1, 8.2, 8.3_

- [ ] 3. データベース設計と初期セットアップ
  - sql-migrateの設定ファイル作成
  - Users、Portfolio、PortfolioItem、Transactionテーブルのマイグレーションファイル作成
  - 初期データベーススキーマの実装
  - データベース接続テストの実装
  - _要件: 7.8, 7.9_

- [ ] 3.1 環境変数とシークレット管理
  - .envファイルの作成と環境変数の整理
  - データベース接続情報の環境変数化
  - JWT秘密鍵とその他のシークレット設定
  - 開発・本番環境の設定分離
  - _要件: 5.3, 5.4_

- [x] 4. バックエンド基盤構築
  - FastAPIプロジェクト構造の作成（DDD構成：domain/application/infrastructure/presentation）
  - requirements.txtファイルの作成（全依存関係の正確なバージョン指定）
  - SQLAlchemy 2.0.43データベース接続設定の実装
  - 基本的なAPIルーター構造とmain.pyの実装（CORS設定含む）
  - ヘルスチェックエンドポイントの実装
  - _要件: 7.2, 7.3, 7.8_

- [ ] 5. データモデル実装
  - SQLAlchemyモデルクラス（User、Portfolio、PortfolioItem、Transaction）の実装
  - 現在のmodels/__init__.pyで参照されているが存在しないモデルファイルの作成
  - Pydanticスキーマクラス（DTOクラス）の実装
  - データベースセッション管理の実装
  - モデル間のリレーションシップ設定
  - _要件: 7.8, 7.9_

- [ ] 6. 認証・認可システム実装
  - JWT認証機能の実装（jose、passlib使用）
  - ユーザー登録・ログインAPIエンドポイントの作成
  - パスワードハッシュ化とセキュリティ対策の実装
  - 認証ミドルウェアの実装
  - _要件: 5.2, 5.3_

- [ ] 7. 株式管理API実装
  - 株式CRUD操作のAPIエンドポイント作成（/api/stocks）
  - 株式データのバリデーション機能実装
  - 株式一覧取得、追加、更新、削除機能の実装
  - エラーハンドリングの実装
  - _要件: 1.1, 1.3, 1.4_

- [ ] 8. 株価取得機能実装
  - yfinanceライブラリを使用した株価取得サービス作成
  - 株価データの取得とデータベース保存機能実装
  - 外部API障害時のエラーハンドリング実装
  - 株価更新APIエンドポイント（/api/stocks/prices）の実装
  - _要件: 1.5, 4.2_

- [ ] 9. 株価自動更新機能実装
  - APSchedulerを使用した定期的な株価更新機能実装
  - ログイン時の自動株価更新機能実装
  - 手動株価更新APIエンドポイントの実装
  - 株価更新状態の管理機能実装
  - _要件: 1.6, 1.7, 4.3_

- [ ] 10. 配当管理API実装
  - 配当CRUD操作のAPIエンドポイント作成（/api/dividends）
  - 配当履歴の登録・表示機能実装
  - 配当統計計算機能の実装（/api/dividends/stats）
  - 配当利回り計算機能の実装
  - _要件: 2.1, 2.2, 2.3, 2.4_

- [ ] 11. 分析・統計API実装
  - ポートフォリオ分析APIの実装（/api/analytics/portfolio）
  - 損益計算機能の実装（/api/analytics/performance）
  - 配当分析APIの実装（/api/analytics/dividends）
  - 資産推移データ取得APIの実装
  - _要件: 1.2, 2.4, 3.2, 3.4_

- [x] 12. フロントエンド基盤構築
  - Next.js 14.2.5プロジェクトの初期セットアップ
  - TypeScript ^5.0厳密設定（tsconfig.json）の作成
  - TailwindCSS ^3.4.7の設定とスタイル基盤構築
  - 基本的なレイアウト（AuthenticatedLayout）とルーティング構造の作成
  - メインページとナビゲーション構造の実装
  - _要件: 7.1, 7.7_

- [x] 13. フロントエンドAPI連携基盤
  - Axios ^1.6.7の設定
  - 認証状態管理（AuthContext）の基本実装
  - 基本的なページ構造（portfolio、transactions、analysis）の作成
  - Next.js App Routerによるルーティング設定
  - _要件: 5.2_

- [ ] 14. 認証UI実装
  - ログイン・ユーザー登録フォームコンポーネントの作成（/login、/registerページ）
  - AuthContextの実際のAPI連携実装（現在は仮実装）
  - JWTトークン管理とAPI認証の実装
  - 認証状態に基づくルーティング保護の実装（現在は基本実装済み）
  - 認証エラー処理の実装
  - _要件: 5.2_

- [ ] 15. 株式管理UI実装
  - 株式一覧表示コンポーネントの作成
  - 株式追加・編集フォームの実装
  - 株式削除確認ダイアログの実装
  - 株価表示と損益計算表示の実装
  - _要件: 1.1, 1.2, 1.3, 1.4_

- [ ] 16. 株価更新UI実装
  - 株価更新ボタンコンポーネントの作成
  - 株価更新状態（ローディング、成功、エラー）の表示機能実装
  - リアルタイム株価表示の実装
  - 最終更新時刻表示の実装
  - _要件: 1.7, 1.2_

- [ ] 17. 配当管理UI実装
  - 配当履歴一覧表示コンポーネントの作成
  - 配当追加・編集フォームの実装
  - 配当統計表示機能の実装
  - 配当利回り表示の実装
  - _要件: 2.1, 2.2, 2.3_

- [ ] 18. ダッシュボード実装
  - メインダッシュボードページの作成
  - ポートフォリオサマリー表示の実装
  - 資産推移概要表示の実装
  - 最近の配当履歴表示の実装
  - _要件: 3.2, 3.4_

- [ ] 19. データ可視化機能実装
  - Chart.js/Rechartsライブラリの設定
  - 資産推移時系列グラフコンポーネントの実装
  - 銘柄別構成比円グラフコンポーネントの実装
  - 配当推移グラフコンポーネントの実装
  - _要件: 3.1, 3.2, 3.3, 3.4_

- [x] 20. ELKスタック基本設定
  - Elasticsearch 8.11.0、Kibana 8.11.0、Filebeat 8.11.0の基本設定
  - ログ収集設定（filebeat.yml）の作成
  - Docker Composeでの統合設定
  - 基本的なログディレクトリ構造の作成
  - _要件: 8.1, 8.2, 8.3_

- [ ] 21. アプリケーションログ実装
  - 構造化ログ出力の実装（JSON形式）
  - エラーログとアクセスログの設定
  - 個人情報マスキング機能の実装
  - ログレベル設定とログローテーション設定
  - _要件: 8.4, 5.4_

- [x] 22. Nginxリバースプロキシ基本設定
  - Nginx alpineコンテナの設定（nginx.conf）
  - Docker Composeでの基本的なプロキシ設定
  - ログディレクトリの設定
  - ヘルスチェック設定
  - _要件: 7.5, 4.4_

- [ ] 23. セキュリティ強化
  - SQLインジェクション対策の検証とテスト
  - 機密情報暗号化の実装
  - セキュリティヘッダー（HTTPS、CSP等）の設定
  - 入力値サニタイゼーション機能の実装
  - _要件: 5.1, 5.3, 5.4_

- [ ] 24. テスト実装
  - バックエンドユニットテスト（pytest）の作成
  - API統合テスト（TestClient）の実装
  - フロントエンドコンポーネントテスト（Jest/Testing Library）の作成
  - E2Eテスト（Playwright）の基本シナリオ実装
  - _要件: 全機能要件のテスト_

- [ ] 25. Ngrok外部公開設定
  - Ngrok設定ファイルの作成
  - 外部アクセス用のCORS設定調整
  - 一時的外部公開用のスクリプト作成
  - セキュリティ設定の調整
  - _要件: 4.1, 4.4_

- [ ] 26. パフォーマンス最適化
  - データベースクエリ最適化（インデックス設定）
  - フロントエンドバンドル最適化（Next.js設定）
  - 株価取得APIのキャッシュ実装（Redis/メモリキャッシュ）
  - 画像最適化とレスポンシブ対応
  - _要件: 4.3_

- [ ] 27. 統合テストと動作確認
  - 全機能の統合テスト実行
  - ユーザーシナリオベースの動作確認
  - パフォーマンステストの実行
  - セキュリティテストの実行
  - _要件: 全要件の統合確認_

- [x] 28.1 技術スタック文書更新
  - 技術スタック一覧の実際のバージョン情報への更新
  - requirements.txtとpackage.jsonの内容反映
  - Docker Composeの実際の設定反映
  - 開発環境の実際の構成反映
  - _要件: ドキュメント整備_

- [ ] 28. ドキュメント整備
  - OpenAPI仕様書の作成（Swagger UI）
  - ユーザーマニュアルの作成
  - 開発者向けREADMEの更新
  - アーキテクチャ図の最終更新
  - _要件: 開発完了後のドキュメント整備_